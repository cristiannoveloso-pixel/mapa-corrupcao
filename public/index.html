<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mapa da Corrup√ß√£o - Brasil Transparente</title>

  <!-- Tailwind (dev CDN - para produ√ß√£o recomendo build local) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <!-- Seu CSS -->
  <link rel="stylesheet" href="styles.css" />
  <style>
    /* Pequenas garantias visuais para a vers√£o limpa */
    body{font-family:Poppins,system-ui,Arial;background:#0f172a;color:#e6eef8}
    .submenu{display:none}
    #map{height:650px;border-radius:8px}
    .case-card{background:#0b1220;border-radius:8px;padding:12px;margin-bottom:8px;border:1px solid rgba(255,255,255,0.03)}
    #submenu-politicos{position:absolute;z-index:100500;min-width:220px}
  </style>
</head>
<body class="bg-slate-950 text-gray-100 font-[Poppins,sans-serif]">

  <!-- HEADER -->
  <header class="bg-gray-900 text-gray-200">
    <div class="header-top-bar py-2 px-4 text-sm flex flex-col md:flex-row justify-between items-center">
      <div class="mb-2 md:mb-0">
        <span>√öltimas Atualiza√ß√µes: Casos de corrup√ß√£o no Senado Federal</span>
      </div>
      <div class="flex space-x-4">
       <a href="#" id="btnAddCase" class="nav-link text-yellow-400 hover:text-yellow-300"><i class="fa-solid fa-plus mr-1"></i> admin</a>
      </div>
    </div>

    <div class="container mx-auto py-4 px-4 flex flex-col md:flex-row justify-between items-center">
      <div class="flex items-center mb-4 md:mb-0">
        <img src="logo_brasil_transparente.png" alt="Logo Brasil Transparente" class="mr-3" style="height:60px;display:inline-block;vertical-align:middle;">
        <h1 class="text-4xl font-extrabold text-yellow-400 drop-shadow-md tracking-wide inline-block align-middle">Mapa da Corrup√ß√£o</h1>
      </div>
    </div>

    <!-- NAV -->
    <nav class="bg-gray-900 py-3">
      <div class="container mx-auto px-4 flex flex-col md:flex-row gap-4 md:items-center">
        <div class="flex gap-2 md:gap-4 items-start md:items-center w-full md:w-auto">
          <div class="nav-item">
            <button id="menu-button" class="md:hidden text-gray-200 focus:outline-none">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
              </svg>
            </button>

            <ul id="main-menu" class="hidden md:flex md:space-x-4 flex-col md:flex-row w-full md:w-auto">
              <li><a href="#" class="nav-link">P√°gina Inicial</a></li>

<div class="nav-item">
  <div class="nav-link flex items-center justify-between cursor-pointer" data-toggle="submenu-politicos">
    <span>Pol√≠ticos</span>
    <svg class="w-4 h-4 ml-1 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
    </svg>
  </div>

  <div id="submenu-politicos" class="submenu bg-slate-900 border border-slate-700 rounded-xl mt-2 p-3">
    <h4 class="text-yellow-400 font-semibold mb-2">Classifica√ß√£o</h4>
    <ul id="tipos-politicos" class="space-y-1 text-sm">
      <li class="hover:text-yellow-400 cursor-pointer" data-cargo="presidente">Presidentes</li>
      <li class="hover:text-yellow-400 cursor-pointer" data-cargo="governador">Governadores</li>
      <li class="hover:text-yellow-400 cursor-pointer" data-cargo="senador">Senadores</li>
      <li class="hover:text-yellow-400 cursor-pointer" data-cargo="deputado federal">Deputados Federais</li>
      <li class="hover:text-yellow-400 cursor-pointer" data-cargo="deputado estadual">Deputados Estaduais</li>
    </ul>

    <div id="lista-politicos" class="hidden mt-3 max-h-[360px] overflow-y-auto"></div>

    <div id="ficha-politico" class="hidden mt-3 p-3 bg-slate-800 border border-slate-700 rounded-lg animate-fade-in">
      <button id="voltar-politicos" class="mb-3 text-yellow-400 hover:text-yellow-300 flex items-center gap-1">
        <i class="fa-solid fa-arrow-left"></i> Voltar
      </button>
      <div id="dados-politico"></div>
    </div>
  </div>
</div>

              <div class="nav-item">
                <div class="nav-link" data-toggle="menu-regioes">
                  Regi√µes
                  <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                  </svg>
                </div>
                <div id="menu-regioes" class="submenu">
                  <a href="#" data-regiao="norte">Norte</a>
                  <a href="#" data-regiao="nordeste">Nordeste</a>
                  <a href="#" data-regiao="centro-oeste">Centro-Oeste</a>
                  <a href="#" data-regiao="sudeste">Sudeste</a>
                  <a href="#" data-regiao="sul">Sul</a>
                </div>
              </div>

    <div class="nav-item">
      <select id="stateSelect" class="bg-slate-800 border border-slate-600 text-gray-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-yellow-400 transition">
          <option value="">Estados</option>
          <option value="Acre">Acre</option>
          <option value="Alagoas">Alagoas</option>
          <option value="Amap√°">Amap√°</option>
          <option value="Amazonas">Amazonas</option>
          <option value="Bahia">Bahia</option>
          <option value="Cear√°">Cear√°</option>
          <option value="Distrito Federal">Distrito Federal</option>
          <option value="Esp√≠rito Santo">Esp√≠rito Santo</option>
          <option value="Goi√°s">Goi√°s</option>
          <option value="Maranh√£o">Maranh√£o</option>
          <option value="Mato Grosso">Mato Grosso</option>
          <option value="Mato Grosso do Sul">Mato Grosso do Sul</option>
          <option value="Minas Gerais">Minas Gerais</option>
          <option value="Par√°">Par√°</option>
          <option value="Para√≠ba">Para√≠ba</option>
          <option value="Paran√°">Paran√°</option>
          <option value="Pernambuco">Pernambuco</option>
          <option value="Piau√≠">Piau√≠</option>
          <option value="Rio de Janeiro">Rio de Janeiro</option>
          <option value="Rio Grande do Norte">Rio Grande do Norte</option>
          <option value="Rio Grande do Sul">Rio Grande do Sul</option>
          <option value="Rond√¥nia">Rond√¥nia</option>
          <option value="Roraima">Roraima</option>
          <option value="Santa Catarina">Santa Catarina</option>
          <option value="S√£o Paulo">S√£o Paulo</option>
          <option value="Sergipe">Sergipe</option>
          <option value="Tocantins">Tocantins</option>
    </select>
  </div>
            <div class="nav-item">
          <a href="cidades.html" class="nav-link">Cidades</a>
        </div>
              <li><a href="leis.html" class="nav-link">Leis Anticorrup√ß√£o</a></li>
              <li><a href="poderes.html" class="nav-link">Os Tr√™s Poderes</a></li>
            </ul>
          </div>
        </div>
      </div>
    </nav>
  </header>

  <!-- MAIN -->
  <main class="container mx-auto px-4 py-6 flex flex-col lg:flex-row gap-6">
    <section class="flex-1 bg-slate-900 p-4 rounded-lg shadow-lg">
      <div id="total-casos" class="total-casos mb-3"></div>

<div class="flex flex-wrap items-center justify-between bg-slate-900 text-gray-100 p-3 rounded-lg mb-2 shadow-md gap-2">
  <div id="total-casos" class="text-yellow-300 text-lg mb-2 font-semibold"> Total de casos de corrup√ß√£o registrados no Brasil: <strong>0</strong>
</div>
  <input type="text" id="searchInput" placeholder="Pesquisar por estado, cidade ou ano..." class="flex-1 min-w-[200px] max-w-lg bg-slate-800 border border-slate-600 text-gray-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-yellow-400" />
  <button id="recenter" class="recenter-btn">üîÑ Recentrar mapa</button>
</div>
    <div id="map" class="w-full h-[650px] rounded-lg shadow-lg"></div>
    <div id="cases-container" class="mt-4 text-sm text-gray-300"></div>
  </section>

  <aside class="sidebar w-full lg:w-[24%]">
    <h3>Mais Lidos</h3>
    <ul>
      <li><a href="#">1. Como identificar sinais de corrup√ß√£o em √≥rg√£os p√∫blicos.</a></li>
      <li><a href="#">2. Os 10 maiores esc√¢ndalos de corrup√ß√£o da hist√≥ria do Brasil.</a></li>
      <li><a href="#">3. Guia completo sobre a Lei Anticorrup√ß√£o (Lei n¬∫ 12.846/2013).</a></li>
      <li><a href="#">4. O impacto da corrup√ß√£o na economia brasileira: um estudo de caso.</a></li>
      <li><a href="#">5. Den√∫ncias an√¥nimas: como proteger-se e combater o crime.</a></li>
    </ul>

    <h3>Leis e Legisla√ß√£o</h3>
    <ul>
      <li><a href="#">Lei de Improbidade Administrativa (Lei 8.429/92)</a></li>
      <li><a href="#">Lei n¬∫ 12.846/2013 (Lei Anticorrup√ß√£o)</a></li>
      <li><a href="#">C√≥digo Penal - Crimes Contra a Administra√ß√£o P√∫blica</a></li>
      <li><a href="#">Lei de Acesso √† Informa√ß√£o (Lei 12.527/11)</a></li>
    </ul>

    <h3>√ìrg√£os de Combate</h3>
    <ul>
      <li><a href="https://www.mpf.mp.br/" target="_blank">Minist√©rio P√∫blico Federal (MPF)</a></li>
      <li><a href="https://www.pf.gov.br/" target="_blank">Pol√≠cia Federal (PF)</a></li>
      <li><a href="https://www.cgu.gov.br/" target="_blank">Controladoria-Geral da Uni√£o (CGU)</a></li>
      <li><a href="https://www.tcu.gov.br/" target="_blank">Tribunal de Contas da Uni√£o (TCU)</a></li>
      <li><a href="https://www.stf.jus.br/" target="_blank">Supremo Tribunal Federal (STF)</a></li>
    </ul>

    <div class="alert-box">
      <p><strong>Denuncie a Corrup√ß√£o!</strong></p>
      <p class="descricao">Sua voz faz a diferen√ßa. Contribua para um Brasil mais justo.</p>
      <a href="https://www.mpf.mp.br/mpfservicos/denuncia">Fa√ßa sua Den√∫ncia Aqui</a>
    </div>
  </aside>
</main>
  <footer class="footer">
    <div class="footer-container">
      <div class="footer-left">
        <img src="logo_brasil_transparente.png" alt="Logo Brasil Transparente" style="height:48px;">
        <p class="footer-text">¬© 2025 Cristiano Veloso | Todos os direitos reservados</p>
      </div>
      <div class="footer-right">
        <a href="https://wa.me/63999480786" target="_blank" class="footer-icon"><i class="fa-brands fa-whatsapp"></i></a>
        <a href="https://www.linkedin.com/in/cristiano.veloso/" target="_blank" class="footer-icon"><i class="fa-brands fa-linkedin-in"></i></a>
        <a href="https://www.instagram.com/seu_perfil_aqui/" target="_blank" class="footer-icon"><i class="fa-brands fa-instagram"></i></a>
      </div>
    </div>
  </footer>

  <!-- SCRIPTS CONSOLIDADOS (sem duplica√ß√µes) -->
  <script>
    // ---------- UTIL ----------
    const normaliza = s => s ? s.normalize('NFD').replace(/[ÃÄ-ÕØ]/g, '').toLowerCase().trim() : '';

    // ---------- GLOBALS ----------
    let casosData = [];
    let map = null;
    let geoLayer = null;

  // ---------- FUN√á√ÉO DE COR ----------
function getColor(qtd) {
  if (qtd === 0) return '#1e40af';
  if (qtd <= 2) return '#2563eb';
  if (qtd <= 4) return '#facc15';
  return '#dc2626';
}

// ---------- INICIALIZA MAPA + DADOS ----------
async function initMapAndData() {
  const mapEl = document.getElementById('map');
  const boundsBrasil = L.latLngBounds(L.latLng(-34.0, -74.0), L.latLng(6.0, -32.0));

  // Cria o mapa
  map = L.map('map', { zoomControl: true, attributionControl: false, minZoom: 3, maxZoom: 7 })
          .setView([-14.2, -51.9], 4);

  L.rectangle(boundsBrasil, { color: '#0f172a', fillColor: '#0f172a', fillOpacity: 1, weight: 0 }).addTo(map);

  document.getElementById('recenter')?.addEventListener('click', () => map.fitBounds(boundsBrasil));

  // 1Ô∏è‚É£ Buscar casos
  try {
    const response = await fetch('/api/cases');
    casosData = await response.json();
    console.log("‚úÖ Casos carregados:", casosData.length);
  } catch (e) {
    console.error('Erro ao carregar casos:', e);
    casosData = [];
  }

  // 2Ô∏è‚É£ Atualizar contador
  const contadorEl = document.querySelector('#total-casos strong') || document.getElementById('total-casos');
  if (contadorEl) contadorEl.innerHTML = `üßæ Total de casos: <strong>${casosData.length}</strong>`;

  // 3Ô∏è‚É£ Converter siglas para nomes completos
  const SIGLAS = {
    AC:"Acre", AL:"Alagoas", AP:"Amap√°", AM:"Amazonas", BA:"Bahia", CE:"Cear√°",
    DF:"Distrito Federal", ES:"Esp√≠rito Santo", GO:"Goi√°s", MA:"Maranh√£o",
    MT:"Mato Grosso", MS:"Mato Grosso do Sul", MG:"Minas Gerais", PA:"Par√°",
    PB:"Para√≠ba", PR:"Paran√°", PE:"Pernambuco", PI:"Piau√≠", RJ:"Rio de Janeiro",
    RN:"Rio Grande do Norte", RS:"Rio Grande do Sul", RO:"Rond√¥nia", RR:"Roraima",
    SC:"Santa Catarina", SP:"S√£o Paulo", SE:"Sergipe", TO:"Tocantins"
  };
  casosData = casosData.map(c => ({ ...c, state_normal: normaliza(SIGLAS[c.state] || c.state) }));

  // 4Ô∏è‚É£ Carregar GeoJSON
  try {
    const r = await fetch('https://raw.githubusercontent.com/codeforamerica/click_that_hood/master/public/data/brazil-states.geojson');
    const geo = await r.json();

    geoLayer = L.geoJSON(geo, {
      style: f => {
        const nome = normaliza(f.properties.name);
        const qtd = casosData.filter(c => c.state_normal === nome).length;
        return { color: '#facc15', weight: 1, fillColor: getColor(qtd), fillOpacity: 0.8 };
      },
      onEachFeature: (f, layer) => {
        const nome = f.properties.name;
        const qtd = casosData.filter(c => c.state_normal === normaliza(nome)).length;
        layer.bindTooltip(`${nome} ‚Äî ${qtd} caso${qtd !== 1 ? 's' : ''}`, { direction: 'top', className: 'tooltip-estado' });
        layer.on('click', () => exibirCasos(casosData.filter(c => c.state_normal === normaliza(nome)), nome));
      }
    }).addTo(map);

    map.fitBounds(boundsBrasil);
    console.log("üó∫Ô∏è GeoJSON carregado com sucesso");
  } catch (err) {
    console.error('‚ùå Erro GeoJSON:', err);
  }
  // ---------- LEGENDA ----------
const legend = L.control({ position: 'bottomright' });

legend.onAdd = function () {
  const div = L.DomUtil.create('div', 'info legend');
  const grades = [0, 1, 3, 5];
  const labels = [];

  div.innerHTML += '<h4 style="margin-bottom:6px;">Casos de Corrup√ß√£o</h4>';

  for (let i = 0; i < grades.length; i++) {
    const from = grades[i];
    const to = grades[i + 1];

    div.innerHTML +=
      `<i style="background:${getColor(from + 1)}; width:18px; height:18px; display:inline-block; margin-right:5px; border-radius:3px;"></i>` +
      (to ? `${from}‚Äì${to - 1}` : `${from}+`) + '<br>';
  }

  return div;
};

legend.addTo(map);


  mapEl.classList.add('loaded');
}

    function exibirCasos(casos, nome){
      const div = document.getElementById('cases-container');
      div.innerHTML = `<h3 style="color:#facc15;">Casos em ${nome}</h3>`;
      if(!casos.length) return div.innerHTML += `<p style="color:#94a3b8;">Nenhum caso registrado.</p>`;
      casos.forEach(c => {
        const card = document.createElement('div');
        card.className = 'case-card';
        card.innerHTML = `
          <h4>${c.title}</h4>
          <p><strong>${c.city || c.municipality || '‚Äî'}</strong> ‚Äî ${c.year || c.date || ''}</p>
          <p>${c.summary || ''}</p>
          <a href="${c.source || c.url || '#'}" target="_blank" style="color:#60a5fa;">Fonte oficial</a>
        `;
        div.appendChild(card);
      });
    }

    // ---------- Intera√ß√µes do menu & filtros ----------
    document.addEventListener('DOMContentLoaded', () => {
      initMapAndData();

      // mobile menu
      const menuButton = document.getElementById('menu-button');
      menuButton && menuButton.addEventListener('click', () => {
        const menu = document.getElementById('main-menu');
        if(menu.classList.contains('hidden')){ menu.classList.remove('hidden'); menu.classList.add('flex'); }
        else { menu.classList.add('hidden'); menu.classList.remove('flex'); }
      });

      // submenu toggles (single handler)
      document.querySelectorAll('[data-toggle]').forEach(toggle => {
        toggle.addEventListener('click', (e) => {
          e.preventDefault();
          const targetId = toggle.getAttribute('data-toggle');
          const submenu = document.getElementById(targetId);
          if(!submenu) return;
          // fecha outros
          document.querySelectorAll('.submenu').forEach(el => { if(el !== submenu) el.style.display = 'none'; });
          submenu.style.display = (submenu.style.display === 'block') ? 'none' : 'block';
        });
      });

      // fechar submenus ao clicar fora
      document.addEventListener('click', (e) => {
        const isToggle = e.target.closest('[data-toggle]');
        const isSubmenu = e.target.closest('.submenu');
        if(!isToggle && !isSubmenu){ document.querySelectorAll('.submenu').forEach(el => el.style.display = 'none'); }
      });

      // regiao buttons
      document.querySelectorAll('[data-regiao]').forEach(btn => {
        btn.addEventListener('click', async (e) => {
          e.preventDefault();
          const regiao = btn.dataset.regiao.toLowerCase();
          try{
            const resp = await fetch('/api/cases');
            const data = await resp.json();
            const filtrados = data.filter(c => normaliza(c.region) === regiao);
            exibirCasos(filtrados, btn.textContent || regiao);
          }catch(err){ console.error(err); }
        });
      });

      // state select
      const stateSelect = document.getElementById('stateSelect');
      stateSelect && stateSelect.addEventListener('change', async (e) => {
        const estado = e.target.value;
        const container = document.getElementById('cases-container');
        if(!estado){ container.innerHTML = ''; return; }
        let data = casosData.length ? casosData : (await (await fetch('/api/cases')).json()).map(c=> ({...c, state_normal: normaliza(c.state)}));
        const casos = data.filter(c => normaliza(c.state) === normaliza(estado));
        exibirCasos(casos, estado);

        if(window.geoLayer){
          let encontrado = false;
          window.geoLayer.eachLayer(layer => {
            const nome = layer.feature?.properties?.name;
            if(nome && nome.toLowerCase() === estado.toLowerCase()){
              encontrado = true;
              map.fitBounds(layer.getBounds(), { maxZoom: 7, padding: [20,20] });
              const originalStyle = { ...layer.options };
              layer.setStyle({ color: '#facc15', weight: 2, fillOpacity: 0.6 });
              setTimeout(() => { if(window.geoLayer.resetStyle) window.geoLayer.resetStyle(layer); else layer.setStyle(originalStyle); }, 3000);
            }
          });
          if(!encontrado) console.warn('Estado n√£o encontrado no mapa:', estado);
        }
      });

      // search input
      const searchInput = document.getElementById('searchInput');
      searchInput && searchInput.addEventListener('input', (e) => {
        const q = normaliza(e.target.value);
        const filtrados = (casosData || []).filter(c => (c.title && normaliza(c.title).includes(q)) || (c.state && normaliza(c.state).includes(q)) || (c.municipality && normaliza(c.municipality).includes(q)) || (c.region && normaliza(c.region).includes(q)));
        exibirCasos(filtrados, 'Resultado da pesquisa');
      });

      // setup politicos panel
      setupPoliticosPanel();

      // admin button
      document.getElementById('btnAddCase') && document.getElementById('btnAddCase').addEventListener('click', function(e){ e.preventDefault(); const senha = prompt('üîë Digite a senha de administrador para acessar o cadastro:'); if(senha === '12345') window.location.href = 'add-case.html'; else if(senha !== null) alert('‚ùå Senha incorreta. Acesso negado.'); });
    });

    // ---------- POL√çTICOS PANEL ----------
    function setupPoliticosPanel(){
      const trigger = document.querySelector('[data-toggle="submenu-politicos"]');
      const submenu = document.getElementById('submenu-politicos');
      if(!trigger || !submenu) return;

      // move to body to avoid clipping
      document.body.appendChild(submenu);
      submenu.style.display = 'none';

      function posicionarSubmenu(){
        const rect = trigger.getBoundingClientRect();
        const submenuRect = submenu.getBoundingClientRect();
        const margin = 8;
        let top = rect.bottom + margin + window.scrollY;
        if(top + submenuRect.height > window.scrollY + window.innerHeight) top = rect.top - submenuRect.height - margin + window.scrollY;
        let left = rect.left + window.scrollX;
        if(left + submenuRect.width > window.innerWidth - 8) left = window.innerWidth - submenuRect.width - 8 + window.scrollX;
        if(left < 8) left = 8 + window.scrollX;
        submenu.style.top = `${top}px`;
        submenu.style.left = `${left}px`;
      }

      let aberto = false;
      trigger.addEventListener('click', (ev) => { ev.preventDefault(); ev.stopPropagation(); if(aberto) { submenu.style.display = 'none'; aberto = false; } else { posicionarSubmenu(); submenu.style.display = 'block'; aberto = true; } });

      document.addEventListener('click', (e) => { if(!aberto) return; if(!e.target.closest('#submenu-politicos') && !e.target.closest('[data-toggle="submenu-politicos"]')) { submenu.style.display = 'none'; aberto = false; } });
      window.addEventListener('resize', () => { if(aberto) posicionarSubmenu(); });
      window.addEventListener('scroll', () => { if(aberto) posicionarSubmenu(); });

      // tipos politicos
      document.querySelectorAll('#tipos-politicos li[data-cargo]').forEach(li => {
        li.addEventListener('click', async () => {
          const cargo = li.getAttribute('data-cargo');
          const lista = document.getElementById('lista-politicos');
          lista.classList.remove('hidden'); lista.innerHTML = `<p class="text-gray-400 text-sm">Carregando ${cargo}s...</p>`;
          try{
            const resp = await fetch(`/api/politicos?cargo=${encodeURIComponent(cargo)}`);
            const data = await resp.json();
            if(!data.length) lista.innerHTML = `<p class="text-gray-400 text-sm">Nenhum ${cargo} encontrado no banco.</p>`;
            else{
              lista.innerHTML = data.map(p => `
                <div class='bg-slate-800 border border-slate-700 rounded-lg p-3 mb-2'>
                  <h4 class='text-yellow-400 font-semibold text-base'>${p.nome}</h4>
                  <p class='text-sm text-gray-300'>Partido: ${p.partido || '‚Äî'} | Estado: ${p.estado || '‚Äî'}</p>
                  <button class='ver-detalhes bg-blue-600 hover:bg-blue-700 text-white text-xs mt-2 px-3 py-1 rounded' data-id='${p.id}'>Ver Detalhes</button>
                </div>`).join('');

              lista.querySelectorAll('.ver-detalhes').forEach(btn => btn.addEventListener('click', () => exibirPolitico(btn.dataset.id)));
            }
          }catch(e){ lista.innerHTML = `<p class='text-red-500'>Erro ao carregar ${cargo}s.</p>`; console.error(e); }
        });
      });
    }

    async function exibirPolitico(id){
      try{
        const resp = await fetch('/api/politicos');
        const todos = await resp.json();
        const politico = todos.find(p => p.id == id);
        if(!politico) return;

        const noticiasResp = await fetch(`/api/politicos/${id}/news`).catch(() => ({ json: async () => [] }));
        const noticias = await noticiasResp.json();

        const painel = document.getElementById('painel-politico') || createPainelPolitico();
        const conteudo = painel.querySelector('#conteudo-politico');
        const temCasos = noticias && noticias.length > 0;

        let html = `<h3>${politico.nome}</h3>`;
        html += `<div class="campo"><strong>Cargo:</strong> ${politico.cargo}</div>`;
        html += `<div class="campo"><strong>Partido:</strong> ${politico.partido || '‚Äî'}</div>`;
        html += `<div class="campo"><strong>Estado:</strong> ${politico.estado || '‚Äî'}</div>`;
        html += `<div class="campo"><strong>Status:</strong> ${temCasos ? "<span style='color:#dc2626'>Citado em casos de corrup√ß√£o</span>" : "<span style='color:#22c55e'>Sem registros</span>"}</div>`;

        if(temCasos){ html += `<h4 style='color:#facc15;margin-top:1rem;'>Casos relacionados:</h4>` + noticias.map(n => `
          <div class='caso'>
            <h4>${n.title}</h4>
            <p>${n.summary || ''}</p>
            <a href='${n.url}' target='_blank'>Ver mais</a>
          </div>
        `).join(''); }

        conteudo.innerHTML = html;
        painel.classList.add('aberto');
      }catch(err){ console.error(err); alert('Erro ao carregar dados do pol√≠tico.'); }
    }

    function createPainelPolitico(){
      let painel = document.getElementById('painel-politico');
      if(painel) return painel;
      painel = document.createElement('div');
      painel.id = 'painel-politico';
      painel.innerHTML = `<button class='fechar-btn'>&times;</button><div id='conteudo-politico'></div>`;
      document.body.appendChild(painel);
      painel.querySelector('.fechar-btn').addEventListener('click', () => painel.classList.remove('aberto'));
      return painel;
    }
    </script>
 <!-- Modal de senha (cole antes de </body>) -->
<div id="adminModal" aria-hidden="true" class="fixed inset-0 z-50 hidden items-center justify-center">
  <div class="absolute inset-0"></div>
  <div class="relative">
    <h3>üîë Acesso administrativo</h3>
    <p>Digite a senha para acessar o cadastro.</p>

    <form id="adminForm" onsubmit="return false;" class="space-y-3">
      <div>
        <label for="adminPassword" class="sr-only">Senha</label>
        <input id="adminPassword" type="password" autocomplete="current-password" placeholder="Senha" />
      </div>

      <div id="adminError">Senha incorreta. Tente novamente.</div>

      <div class="flex justify-end gap-2 mt-2">
        <button id="adminCancel" type="button">Cancelar</button>
        <button id="adminSubmit" type="button">Entrar</button>
      </div>
    </form>
  </div>
</div>
  </script>
</body>
</html>
